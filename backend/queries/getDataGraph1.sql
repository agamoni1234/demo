select date(c.scheduled_dt) order_date, HOUR( CONVERT_TZ(c.created_at, '+00:00','-7:00') )  order_hour , CAST( sum((UNIX_TIMESTAMP(a.field_17) - UNIX_TIMESTAMP(c.created_at))/60 )/count(c.id) AS DECIMAL(10,2)) average_prep_time,  CAST(sum((UNIX_TIMESTAMP(a.field_18) - UNIX_TIMESTAMP(a.field_17))/60 )/count(c.id) AS DECIMAL(10,2)) as average_delivery_time    from firepiedeliveries a join firepieget_swift_deliveries b on a.field_1 = b.field_2 join firepieorders c on a.field_12 = c.id where b.field_5 <> 'Cancelled' and date(CONVERT_TZ(c.created_at, '+00:00','-7:00'))  = '%s' and a.field_17 > 0 group by 1,2 order by 1,2;