/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ElementRef, Renderer2, HostListener } from '@angular/core';
/**
 * @record
 */
function CloudOptionsInternal() { }
if (false) {
    /** @type {?} */
    CloudOptionsInternal.prototype.step;
    /**
     * setting the aspect ratio. This value is calculated by the given width and height
     * @type {?}
     */
    CloudOptionsInternal.prototype.aspectRatio;
    /** @type {?} */
    CloudOptionsInternal.prototype.center;
}
export class TagCloudComponent {
    /**
     * @param {?} el
     * @param {?} r2
     */
    constructor(el, r2) {
        this.el = el;
        this.r2 = r2;
        this.width = 500;
        this.height = 300;
        this.overflow = true;
        this.strict = false;
        this.zoomOnHover = { transitionTime: 0, scale: 1, delay: 0, color: null };
        this.realignOnResize = false;
        this.randomizeAngle = false;
        this.clicked = new EventEmitter();
        this.dataChanges = new EventEmitter();
        this.afterInit = new EventEmitter();
        this.afterChecked = new EventEmitter();
        this._alreadyPlacedWords = [];
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onResize(event) {
        window.clearTimeout(this._timeoutId);
        this._timeoutId = window.setTimeout(() => {
            if (this.realignOnResize) {
                this.reDraw();
            }
        }, 200);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.reDraw(changes);
    }
    /**
     * @param {?=} changes
     * @return {?}
     */
    reDraw(changes) {
        this.dataChanges.emit(changes);
        this._alreadyPlacedWords = [];
        // check if data is not null or empty
        if (!this.data) {
            console.error('angular-tag-cloud: No data passed. Please pass an Array of CloudData');
            return;
        }
        // values changed, reset cloud
        this.el.nativeElement.innerHTML = '';
        // set value changes
        if (changes && changes['data']) {
            this._dataArr = changes['data'].currentValue;
        }
        /** @type {?} */
        let width = this.width;
        if (this.el.nativeElement.parentNode.offsetWidth > 0
            && width <= 1
            && width > 0) {
            width = this.el.nativeElement.parentNode.offsetWidth * width;
        }
        // set options
        this._options = {
            step: 2.0,
            aspectRatio: (width / this.height),
            width: width,
            height: this.height,
            center: {
                x: (width / 2.0),
                y: (this.height / 2.0)
            },
            overflow: this.overflow,
            zoomOnHover: this.zoomOnHover
        };
        this.r2.setStyle(this.el.nativeElement, 'width', this._options.width + 'px');
        this.r2.setStyle(this.el.nativeElement, 'height', this._options.height + 'px');
        // draw the cloud
        this.drawWordCloud();
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.afterInit.emit();
    }
    /**
     * @return {?}
     */
    ngAfterContentChecked() {
        this.afterChecked.emit();
    }
    // helper to generate a descriptive string for an entry to use when sorting alphabetically
    /**
     * @param {?} entry
     * @return {?}
     */
    descriptiveEntry(entry) {
        /** @type {?} */
        let description = entry.text;
        if (entry.color) {
            description += '-' + entry.color;
        }
        if (entry.external) {
            description += '-' + entry.external;
        }
        if (entry.link) {
            description += '-' + entry.link;
        }
        if (entry.rotate) {
            description += '-' + entry.rotate;
        }
        return description;
    }
    /**
     * @return {?}
     */
    drawWordCloud() {
        // Sort alphabetically to ensure that, all things being equal, words are placed uniformly
        this._dataArr.sort((a, b) => (this.descriptiveEntry(a)).localeCompare(this.descriptiveEntry(b)));
        // Sort this._dataArr from the word with the highest weight to the one with the lowest
        this._dataArr.sort((a, b) => b.weight - a.weight);
        this._dataArr.forEach((elem, index) => {
            this.drawWord(index, elem);
        });
    }
    // Helper function to test if an element overlaps others
    /**
     * @param {?} currentEl
     * @param {?} otherEl
     * @return {?}
     */
    hitTest(currentEl, otherEl) {
        // Check elements for overlap one by one, stop and return false as soon as an overlap is found
        for (let i = 0; i < otherEl.length; i++) {
            if (this.overlapping(currentEl, otherEl[i])) {
                return true;
            }
        }
        return false;
    }
    // Pairwise overlap detection
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    overlapping(a, b) {
        return (Math.abs(2.0 * a.offsetLeft + a.offsetWidth - 2.0 * b.offsetLeft - b.offsetWidth) < a.offsetWidth + b.offsetWidth &&
            Math.abs(2.0 * a.offsetTop + a.offsetHeight - 2.0 * b.offsetTop - b.offsetHeight) < a.offsetHeight + b.offsetHeight)
            ? true : false;
    }
    // Function to draw a word, by moving it in spiral until it finds a suitable empty place. This will be iterated on each word.
    /**
     * @param {?} index
     * @param {?} word
     * @return {?}
     */
    drawWord(index, word) {
        // Define the ID attribute of the span that will wrap the word
        /** @type {?} */
        let angle = this.randomizeAngle ? 6.28 * Math.random() : 0;
        /** @type {?} */
        let radius = 0.0;
        /** @type {?} */
        let weight = 5;
        /** @type {?} */
        let wordSpan;
        // Check if min(weight) > max(weight) otherwise use default
        if (this._dataArr[0].weight > this._dataArr[this._dataArr.length - 1].weight) {
            // check if strict mode is active
            if (!this.strict) { // Linearly map the original weight to a discrete scale from 1 to 10
                weight = Math.round((word.weight - this._dataArr[this._dataArr.length - 1].weight) /
                    (this._dataArr[0].weight - this._dataArr[this._dataArr.length - 1].weight) * 9.0) + 1;
            }
            else { // use given value for weigth directly
                // fallback to 10
                if (word.weight > 10) {
                    weight = 10;
                    console.log(`[TagCloud strict] Weight property ${word.weight} > 10. Fallback to 10 as you are using strict mode`, word);
                }
                else if (word.weight < 1) { // fallback to 1
                    weight = 1;
                    console.log(`[TagCloud strict] Given weight property ${word.weight} < 1. Fallback to 1 as you are using strict mode`, word);
                }
                else if (word.weight % 1 !== 0) { // round if given value is not an integer
                    weight = Math.round(word.weight);
                    console.log(`[TagCloud strict] Given weight property ${word.weight} is not an integer. Rounded value to ${weight}`, word);
                }
                else {
                    weight = word.weight;
                }
            }
        }
        // Create a new span and insert node.
        wordSpan = this.r2.createElement('span');
        wordSpan.className = 'w' + weight;
        /** @type {?} */
        const thatClicked = this.clicked;
        wordSpan.onclick = () => {
            thatClicked.emit(word);
        };
        /** @type {?} */
        let node = this.r2.createText(word.text);
        // set color
        if (word.color) {
            this.r2.setStyle(wordSpan, 'color', word.color);
        }
        /** @type {?} */
        let transformString = '';
        // set color
        if (word.rotate) {
            transformString = `rotate(${word.rotate}deg)`;
            this.r2.setStyle(wordSpan, 'transform', transformString);
        }
        // Append href if there's a link alongwith the tag
        if (word.link) {
            /** @type {?} */
            const wordLink = this.r2.createElement('a');
            wordLink.href = word.link;
            if (word.external !== undefined && word.external) {
                wordLink.target = '_blank';
            }
            wordLink.appendChild(node);
            node = wordLink;
        }
        // set zoomOption
        if (this.zoomOnHover && this.zoomOnHover.scale !== 1) {
            if (!this.zoomOnHover.transitionTime) {
                this.zoomOnHover.transitionTime = 0;
            }
            if (!this.zoomOnHover.scale) {
                this.zoomOnHover.scale = 1;
            }
            wordSpan.onmouseover = () => {
                this.r2.setStyle(wordSpan, 'transition', `transform ${this.zoomOnHover.transitionTime}s`);
                this.r2.setStyle(wordSpan, 'transform', `scale(${this.zoomOnHover.scale}) ${transformString}`);
                this.r2.setStyle(wordSpan, 'transition-delay', `${this.zoomOnHover.delay}s`);
                if (this.zoomOnHover.color) {
                    word.link
                        ? this.r2.setStyle(node, 'color', this.zoomOnHover.color)
                        : this.r2.setStyle(wordSpan, 'color', this.zoomOnHover.color);
                }
            };
            wordSpan.onmouseout = () => {
                this.r2.setStyle(wordSpan, 'transform', `scale(1) ${transformString}`);
                word.link
                    ? this.r2.removeStyle(node, 'color')
                    : this.r2.removeStyle(wordSpan, 'color');
            };
        }
        wordSpan.appendChild(node);
        this.r2.appendChild(this.el.nativeElement, wordSpan);
        /** @type {?} */
        const width = wordSpan.offsetWidth;
        /** @type {?} */
        const height = wordSpan.offsetHeight;
        /** @type {?} */
        let left = this._options.center.x;
        /** @type {?} */
        let top = this._options.center.y;
        // Save a reference to the style property, for better performance
        /** @type {?} */
        const wordStyle = wordSpan.style;
        wordStyle.position = 'absolute';
        // place the first word
        wordStyle.left = left + 'px';
        wordStyle.top = top + 'px';
        // add tooltip if provided
        if (word.tooltip) {
            this.r2.addClass(wordSpan, 'tooltip');
            /** @type {?} */
            const tooltipSpan = this.r2.createElement('span');
            tooltipSpan.className = 'tooltiptext';
            /** @type {?} */
            const text = this.r2.createText(word.tooltip);
            tooltipSpan.appendChild(text);
            wordSpan.appendChild(tooltipSpan);
        }
        while (this.hitTest(wordSpan, this._alreadyPlacedWords)) {
            radius += this._options.step;
            angle += (index % 2 === 0 ? 1 : -1) * this._options.step;
            left = this._options.center.x - (width / 2.0) + (radius * Math.cos(angle)) * this._options.aspectRatio;
            top = this._options.center.y + radius * Math.sin(angle) - (height / 2.0);
            wordStyle.left = left + 'px';
            wordStyle.top = top + 'px';
        }
        // Don't render word if part of it would be outside the container
        if (!this._options.overflow &&
            (left < 0 || top < 0 || (left + width) > this._options.width ||
                (top + height) > this._options.height)) {
            wordSpan.remove();
            return;
        }
        this._alreadyPlacedWords.push(wordSpan);
    }
}
TagCloudComponent.decorators = [
    { type: Component, args: [{
                selector: 'angular-tag-cloud, ng-tag-cloud, ngtc',
                template: '',
                styles: [":host{font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:normal;color:#09f;overflow:hidden;position:relative;display:block}span{padding:0}span.w10{font-size:550%}span.w9{font-size:500%}span.w8{font-size:450%}span.w7{font-size:400%}span.w6{font-size:350%}span.w5{font-size:300%}span.w4{font-size:250%}span.w3{font-size:200%}span.w2{font-size:150%}a:hover,span.w10,span.w8,span.w9{color:#0cf}span.w7{color:#39d}span.w6{color:#90c5f0}span.w5{color:#90a0dd}span.w4{color:#90c5f0}span.w3{color:#a0ddff}span.w2{color:#9ce}span.w1{font-size:100%;color:#aab5f0}.tooltip .tooltiptext{visibility:hidden;width:inherit;background-color:#555;color:#fff;text-align:center;border-radius:6px;padding:5px 10px;position:absolute;bottom:100%;left:0;opacity:0;transition:opacity .3s}.tooltip .tooltiptext::after{content:\"\";position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#555 transparent transparent}.tooltip:hover .tooltiptext{visibility:visible;opacity:1}"]
            }] }
];
/** @nocollapse */
TagCloudComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TagCloudComponent.propDecorators = {
    data: [{ type: Input }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    overflow: [{ type: Input }],
    strict: [{ type: Input }],
    zoomOnHover: [{ type: Input }],
    realignOnResize: [{ type: Input }],
    randomizeAngle: [{ type: Input }],
    clicked: [{ type: Output }],
    dataChanges: [{ type: Output }],
    afterInit: [{ type: Output }],
    afterChecked: [{ type: Output }],
    onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    TagCloudComponent.prototype.data;
    /** @type {?} */
    TagCloudComponent.prototype.width;
    /** @type {?} */
    TagCloudComponent.prototype.height;
    /** @type {?} */
    TagCloudComponent.prototype.overflow;
    /** @type {?} */
    TagCloudComponent.prototype.strict;
    /** @type {?} */
    TagCloudComponent.prototype.zoomOnHover;
    /** @type {?} */
    TagCloudComponent.prototype.realignOnResize;
    /** @type {?} */
    TagCloudComponent.prototype.randomizeAngle;
    /** @type {?} */
    TagCloudComponent.prototype.clicked;
    /** @type {?} */
    TagCloudComponent.prototype.dataChanges;
    /** @type {?} */
    TagCloudComponent.prototype.afterInit;
    /** @type {?} */
    TagCloudComponent.prototype.afterChecked;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype._dataArr;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype._alreadyPlacedWords;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype._options;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype._timeoutId;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.r2;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFnLWNsb3VkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItdGFnLWNsb3VkLW1vZHVsZS8iLCJzb3VyY2VzIjpbInNyYy9hcHAvdGFnLWNsb3VkLW1vZHVsZS90YWctY2xvdWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUlULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFVBQVUsRUFDVixTQUFTLEVBRVQsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7O0FBRzdDLG1DQVdDOzs7SUFWQyxvQ0FBYTs7Ozs7SUFLYiwyQ0FBb0I7O0lBQ3BCLHNDQUdFOztBQVFKLE1BQU0sT0FBTyxpQkFBaUI7Ozs7O0lBcUI1QixZQUNVLEVBQWMsRUFDZCxFQUFhO1FBRGIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLE9BQUUsR0FBRixFQUFFLENBQVc7UUFyQmQsVUFBSyxHQUFJLEdBQUcsQ0FBQztRQUNiLFdBQU0sR0FBSSxHQUFHLENBQUM7UUFDZCxhQUFRLEdBQUksSUFBSSxDQUFDO1FBQ2pCLFdBQU0sR0FBSSxLQUFLLENBQUM7UUFDaEIsZ0JBQVcsR0FBd0IsRUFBRSxjQUFjLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDMUYsb0JBQWUsR0FBSSxLQUFLLENBQUM7UUFDekIsbUJBQWMsR0FBSSxLQUFLLENBQUM7UUFFdkIsWUFBTyxHQUE2QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3ZELGdCQUFXLEdBQWlDLElBQUksWUFBWSxFQUFFLENBQUM7UUFDL0QsY0FBUyxHQUF3QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3BELGlCQUFZLEdBQXdCLElBQUksWUFBWSxFQUFFLENBQUM7UUFHekQsd0JBQW1CLEdBQWtCLEVBQUUsQ0FBQztJQVE1QyxDQUFDOzs7OztJ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O0lBQ2pFLHdDQUF5RTs7SUFDekUsc0NBQThEOztJQUM5RCx5Q0FBaUU7Ozs7O0lBRWpFLHFDQUE4Qjs7Ozs7SUFDOUIsZ0RBQWdEOzs7OztJQUVoRCxxQ0FBdUM7Ozs7O0lBQ3ZDLHVDQUFtQjs7Ozs7SUFHakIsK0JBQXNCOzs7OztJQUN0QiwrQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsXG4gICAgICAgICBPbkNoYW5nZXMsXG4gICAgICAgICBBZnRlckNvbnRlbnRJbml0LFxuICAgICAgICAgQWZ0ZXJDb250ZW50Q2hlY2tlZCxcbiAgICAgICAgIElucHV0LFxuICAgICAgICAgT3V0cHV0LFxuICAgICAgICAgRXZlbnRFbWl0dGVyLFxuICAgICAgICAgRWxlbWVudFJlZixcbiAgICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgIFNpbXBsZUNoYW5nZXMsXG4gICAgICAgICBIb3N0TGlzdGVuZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENsb3VkRGF0YSwgQ2xvdWRPcHRpb25zLCBab29tT25Ib3Zlck9wdGlvbnMgfSBmcm9tICcuL3RhZy1jbG91ZC5pbnRlcmZhY2VzJztcblxuaW50ZXJmYWNlIENsb3VkT3B0aW9uc0ludGVybmFsIGV4dGVuZHMgQ2xvdWRPcHRpb25zIHtcbiAgc3RlcDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBzZXR0aW5nIHRoZSBhc3BlY3QgcmF0aW8uIFRoaXMgdmFsdWUgaXMgY2FsY3VsYXRlZCBieSB0aGUgZ2l2ZW4gd2lkdGggYW5kIGhlaWdodFxuICAgKi9cbiAgYXNwZWN0UmF0aW86IG51bWJlcjtcbiAgY2VudGVyOiB7XG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcbiAgfTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYW5ndWxhci10YWctY2xvdWQsIG5nLXRhZy1jbG91ZCwgbmd0YycsXG4gIHRlbXBsYXRlOiAnJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGFnLWNsb3VkLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUYWdDbG91ZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgQWZ0ZXJDb250ZW50SW5pdCwgQWZ0ZXJDb250ZW50Q2hlY2tlZCB7XG4gIEBJbnB1dCgpIGRhdGE6IENsb3VkRGF0YVtdO1xuICBASW5wdXQoKSB3aWR0aD8gPSA1MDA7XG4gIEBJbnB1dCgpIGhlaWdodD8gPSAzMDA7XG4gIEBJbnB1dCgpIG92ZXJmbG93PyA9IHRydWU7XG4gIEBJbnB1dCgpIHN0cmljdD8gPSBmYWxzZTtcbiAgQElucHV0KCkgem9vbU9uSG92ZXI/OiBab29tT25Ib3Zlck9wdGlvbnMgPSB7IHRyYW5zaXRpb25UaW1lOiAwLCBzY2FsZTogMSwgZGVsYXk6IDAsIGNvbG9yOiBudWxsIH07XG4gIEBJbnB1dCgpIHJlYWxpZ25PblJlc2l6ZT8gPSBmYWxzZTtcbiAgQElucHV0KCkgcmFuZG9taXplQW5nbGU/ID0gZmFsc2U7XG5cbiAgQE91dHB1dCgpIGNsaWNrZWQ/OiBFdmVudEVtaXR0ZXI8Q2xvdWREYXRhPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGRhdGFDaGFuZ2VzPzogRXZlbnRFbWl0dGVyPFNpbXBsZUNoYW5nZXM+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgYWZ0ZXJJbml0PzogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgYWZ0ZXJDaGVja2VkPzogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHByaXZhdGUgX2RhdGFBcnI6IENsb3VkRGF0YVtdO1xuICBwcml2YXRlIF9hbHJlYWR5UGxhY2VkV29yZHM6IEhUTUxFbGVtZW50W10gPSBbXTtcblxuICBwcml2YXRlIF9vcHRpb25zOiBDbG91ZE9wdGlvbnNJbnRlcm5hbDtcbiAgcHJpdmF0ZSBfdGltZW91dElkO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSByMjogUmVuZGVyZXIyXG4gICkgeyB9XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScsIFsnJGV2ZW50J10pXG4gIG9uUmVzaXplKGV2ZW50KSB7XG4gICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0SWQpO1xuICAgIHRoaXMuX3RpbWVvdXRJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICh0aGlzLnJlYWxpZ25PblJlc2l6ZSkge1xuICAgICAgICB0aGlzLnJlRHJhdygpO1xuICAgICAgfVxuICAgIH0sIDIwMCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgdGhpcy5yZURyYXcoY2hhbmdlcyk7XG4gIH1cblxuICByZURyYXcoY2hhbmdlcz86IFNpbXBsZUNoYW5nZXMpIHtcbiAgICB0aGlzLmRhdGFDaGFuZ2VzLmVtaXQoY2hhbmdlcyk7XG4gICAgdGhpcy5fYWxyZWFkeVBsYWNlZFdvcmRzID0gW107XG5cbiAgICAvLyBjaGVjayBpZiBkYXRhIGlzIG5vdCBudWxsIG9yIGVtcHR5XG4gICAgaWYgKCF0aGlzLmRhdGEpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2FuZ3VsYXItdGFnLWNsb3VkOiBObyBkYXRhIHBhc3NlZC4gUGxlYXNlIHBhc3MgYW4gQXJyYXkgb2YgQ2xvdWREYXRhJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gdmFsdWVzIGNoYW5nZWQsIHJlc2V0IGNsb3VkXG4gICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9ICcnO1xuXG4gICAgLy8gc2V0IHZhbHVlIGNoYW5nZXNcbiAgICBpZiAoY2hhbmdlcyAmJiBjaGFuZ2VzWydkYXRhJ10pIHtcbiAgICAgIHRoaXMuX2RhdGFBcnIgPSBjaGFuZ2VzWydkYXRhJ10uY3VycmVudFZhbHVlO1xuICAgIH1cblxuICAgIGxldCB3aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgaWYgKHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlLm9mZnNldFdpZHRoID4gMFxuICAgICAgJiYgd2lkdGggPD0gMVxuICAgICAgJiYgd2lkdGggPiAwXG4gICAgKSB7XG4gICAgICB3aWR0aCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlLm9mZnNldFdpZHRoICogd2lkdGg7XG4gICAgfVxuXG4gICAgLy8gc2V0IG9wdGlvbnNcbiAgICB0aGlzLl9vcHRpb25zID0ge1xuICAgICAgc3RlcDogMi4wLFxuICAgICAgYXNwZWN0UmF0aW86ICh3aWR0aCAvIHRoaXMuaGVpZ2h0KSxcbiAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgICBjZW50ZXI6IHtcbiAgICAgICAgeDogKHdpZHRoIC8gMi4wKSxcbiAgICAgICAgeTogKHRoaXMuaGVpZ2h0IC8gMi4wKVxuICAgICAgfSxcbiAgICAgIG92ZXJmbG93OiB0aGlzLm92ZXJmbG93LFxuICAgICAgem9vbU9uSG92ZXI6IHRoaXMuem9vbU9uSG92ZXJcbiAgICB9O1xuXG4gICAgdGhpcy5yMi5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICd3aWR0aCcsIHRoaXMuX29wdGlvbnMud2lkdGggKyAncHgnKTtcbiAgICB0aGlzLnIyLnNldFN0eWxlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2hlaWdodCcsIHRoaXMuX29wdGlvbnMuaGVpZ2h0ICsgJ3B4Jyk7XG4gICAgLy8gZHJhdyB0aGUgY2xvdWRcbiAgICB0aGlzLmRyYXdXb3JkQ2xvdWQoKTtcbiAgfVxuXG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIHRoaXMuYWZ0ZXJJbml0LmVtaXQoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50Q2hlY2tlZCgpIHtcbiAgICB0aGlzLmFmdGVyQ2hlY2tlZC5lbWl0KCk7XG4gIH1cblxuICAvLyBoZWxwZXIgdG8gZ2VuZXJhdGUgYSBkZXNjcmlwdGl2ZSBzdHJpbmcgZm9yIGFuIGVudHJ5IHRvIHVzZSB3aGVuIHNvcnRpbmcgYWxwaGFiZXRpY2FsbHlcbiAgZGVzY3JpcHRpdmVFbnRyeShlbnRyeTogQ2xvdWREYXRhKTogc3RyaW5nIHtcbiAgICBsZXQgZGVzY3JpcHRpb24gPSBlbnRyeS50ZXh0O1xuICAgIGlmIChlbnRyeS5jb2xvcikge1xuICAgICAgZGVzY3JpcHRpb24gKz0gJy0nICsgZW50cnkuY29sb3I7XG4gICAgfVxuICAgIGlmIChlbnRyeS5leHRlcm5hbCkge1xuICAgICAgZGVzY3JpcHRpb24gKz0gJy0nICsgZW50cnkuZXh0ZXJuYWw7XG4gICAgfVxuICAgIGlmIChlbnRyeS5saW5rKSB7XG4gICAgICBkZXNjcmlwdGlvbiArPSAnLScgKyBlbnRyeS5saW5rO1xuICAgIH1cbiAgICBpZiAoZW50cnkucm90YXRlKSB7XG4gICAgICBkZXNjcmlwdGlvbiArPSAnLScgKyBlbnRyeS5yb3RhdGU7XG4gICAgfVxuICAgIHJldHVybiBkZXNjcmlwdGlvbjtcbiAgfVxuXG4gIGRyYXdXb3JkQ2xvdWQgKCkge1xuICAgIC8vIFNvcnQgYWxwaGFiZXRpY2FsbHkgdG8gZW5zdXJlIHRoYXQsIGFsbCB0aGluZ3MgYmVpbmcgZXF1YWwsIHdvcmRzIGFyZSBwbGFjZWQgdW5pZm9ybWx5XG4gICAgdGhpcy5fZGF0YUFyci5zb3J0KCAoYSwgYikgPT4gKHRoaXMuZGVzY3JpcHRpdmVFbnRyeShhKSkubG9jYWxlQ29tcGFyZSh0aGlzLmRlc2NyaXB0aXZlRW50cnkoYikpKTtcbiAgICAvLyBTb3J0IHRoaXMuX2RhdGFBcnIgZnJvbSB0aGUgd29yZCB3aXRoIHRoZSBoaWdoZXN0IHdlaWdodCB0byB0aGUgb25lIHdpdGggdGhlIGxvd2VzdFxuICAgIHRoaXMuX2RhdGFBcnIuc29ydCgoYSwgYikgPT4gYi53ZWlnaHQgLSBhLndlaWdodCk7XG4gICAgdGhpcy5fZGF0YUFyci5mb3JFYWNoKChlbGVtLCBpbmRleCkgPT4ge1xuICAgICAgdGhpcy5kcmF3V29yZChpbmRleCwgZWxlbSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gdGVzdCBpZiBhbiBlbGVtZW50IG92ZXJsYXBzIG90aGVyc1xuICBoaXRUZXN0KGN1cnJlbnRFbDogSFRNTEVsZW1lbnQsIG90aGVyRWw6IEhUTUxFbGVtZW50W10pOiBib29sZWFuIHtcbiAgICAvLyBDaGVjayBlbGVtZW50cyBmb3Igb3ZlcmxhcCBvbmUgYnkgb25lLCBzdG9wIGFuZCByZXR1cm4gZmFsc2UgYXMgc29vbiBhcyBhbiBvdmVybGFwIGlzIGZvdW5kXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvdGhlckVsLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAodGhpcy5vdmVybGFwcGluZyhjdXJyZW50RWwsIG90aGVyRWxbaV0pKSB7IHJldHVybiB0cnVlOyB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIFBhaXJ3aXNlIG92ZXJsYXAgZGV0ZWN0aW9uXG4gIG92ZXJsYXBwaW5nKGE6IEhUTUxFbGVtZW50LCBiOiBIVE1MRWxlbWVudCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoTWF0aC5hYnMoMi4wICogYS5vZmZzZXRMZWZ0ICsgYS5vZmZzZXRXaWR0aCAgLSAyLjAgKiBiLm9mZnNldExlZnQgLSBiLm9mZnNldFdpZHRoKSAgPCBhLm9mZnNldFdpZHRoICArIGIub2Zmc2V0V2lkdGggJiZcbiAgICAgICAgICAgIE1hdGguYWJzKDIuMCAqIGEub2Zmc2V0VG9wICArIGEub2Zmc2V0SGVpZ2h0IC0gMi4wICogYi5vZmZzZXRUb3AgIC0gYi5vZmZzZXRIZWlnaHQpIDwgYS5vZmZzZXRIZWlnaHQgKyBiLm9mZnNldEhlaWdodClcbiAgICA/IHRydWUgOiBmYWxzZTtcbiAgfVxuXG4gIC8vIEZ1bmN0aW9uIHRvIGRyYXcgYSB3b3JkLCBieSBtb3ZpbmcgaXQgaW4gc3BpcmFsIHVudGlsIGl0IGZpbmRzIGEgc3VpdGFibGUgZW1wdHkgcGxhY2UuIFRoaXMgd2lsbCBiZSBpdGVyYXRlZCBvbiBlYWNoIHdvcmQuXG4gIGRyYXdXb3JkKGluZGV4OiBudW1iZXIsIHdvcmQ6IENsb3VkRGF0YSkge1xuICAgIC8vIERlZmluZSB0aGUgSUQgYXR0cmlidXRlIG9mIHRoZSBzcGFuIHRoYXQgd2lsbCB3cmFwIHRoZSB3b3JkXG4gICAgbGV0IGFuZ2xlID0gdGhpcy5yYW5kb21pemVBbmdsZSA/IDYuMjggKiBNYXRoLnJhbmRvbSgpIDogMCxcbiAgICAgICAgcmFkaXVzID0gMC4wLFxuICAgICAgICB3ZWlnaHQgPSA1LFxuICAgICAgICB3b3JkU3BhbjogSFRNTEVsZW1lbnQ7XG5cbiAgICAvLyBDaGVjayBpZiBtaW4od2VpZ2h0KSA+IG1heCh3ZWlnaHQpIG90aGVyd2lzZSB1c2UgZGVmYXVsdFxuICAgIGlmICh0aGlzLl9kYXRhQXJyWzBdLndlaWdodCA+IHRoaXMuX2RhdGFBcnJbdGhpcy5fZGF0YUFyci5sZW5ndGggLSAxXS53ZWlnaHQpIHtcbiAgICAgIC8vIGNoZWNrIGlmIHN0cmljdCBtb2RlIGlzIGFjdGl2ZVxuICAgICAgaWYgKCF0aGlzLnN0cmljdCkgeyAvLyBMaW5lYXJseSBtYXAgdGhlIG9yaWdpbmFsIHdlaWdodCB0byBhIGRpc2NyZXRlIHNjYWxlIGZyb20gMSB0byAxMFxuICAgICAgICB3ZWlnaHQgPSBNYXRoLnJvdW5kKCh3b3JkLndlaWdodCAtIHRoaXMuX2RhdGFBcnJbdGhpcy5fZGF0YUFyci5sZW5ndGggLSAxXS53ZWlnaHQpIC9cbiAgICAgICAgICAgICAgICAgICh0aGlzLl9kYXRhQXJyWzBdLndlaWdodCAtIHRoaXMuX2RhdGFBcnJbdGhpcy5fZGF0YUFyci5sZW5ndGggLSAxXS53ZWlnaHQpICogOS4wKSArIDE7XG4gICAgICB9IGVsc2UgeyAvLyB1c2UgZ2l2ZW4gdmFsdWUgZm9yIHdlaWd0aCBkaXJlY3RseVxuICAgICAgICAvLyBmYWxsYmFjayB0byAxMFxuICAgICAgICBpZiAod29yZC53ZWlnaHQgPiAxMCkge1xuICAgICAgICAgIHdlaWdodCA9IDEwO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbVGFnQ2xvdWQgc3RyaWN0XSBXZWlnaHQgcHJvcGVydHkgJHt3b3JkLndlaWdodH0gPiAxMC4gRmFsbGJhY2sgdG8gMTAgYXMgeW91IGFyZSB1c2luZyBzdHJpY3QgbW9kZWAsIHdvcmQpO1xuICAgICAgICB9IGVsc2UgaWYgKHdvcmQud2VpZ2h0IDwgMSkgeyAvLyBmYWxsYmFjayB0byAxXG4gICAgICAgICAgd2VpZ2h0ID0gMTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW1RhZ0Nsb3VkIHN0cmljdF0gR2l2ZW4gd2VpZ2h0IHByb3BlcnR5ICR7d29yZC53ZWlnaHR9IDwgMS4gRmFsbGJhY2sgdG8gMSBhcyB5b3UgYXJlIHVzaW5nIHN0cmljdCBtb2RlYCwgd29yZCk7XG4gICAgICAgIH0gZWxzZSBpZiAod29yZC53ZWlnaHQgJSAxICE9PSAwKSB7IC8vIHJvdW5kIGlmIGdpdmVuIHZhbHVlIGlzIG5vdCBhbiBpbnRlZ2VyXG4gICAgICAgICAgd2VpZ2h0ID0gTWF0aC5yb3VuZCh3b3JkLndlaWdodCk7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtUYWdDbG91ZCBzdHJpY3RdIEdpdmVuIHdlaWdodCBwcm9wZXJ0eSAke3dvcmQud2VpZ2h0fSBpcyBub3QgYW4gaW50ZWdlci4gUm91bmRlZCB2YWx1ZSB0byAke3dlaWdodH1gLCB3b3JkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3ZWlnaHQgPSB3b3JkLndlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGEgbmV3IHNwYW4gYW5kIGluc2VydCBub2RlLlxuICAgIHdvcmRTcGFuID0gdGhpcy5yMi5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgd29yZFNwYW4uY2xhc3NOYW1lID0gJ3cnICsgd2VpZ2h0O1xuXG4gICAgY29uc3QgdGhhdENsaWNrZWQgPSB0aGlzLmNsaWNrZWQ7XG4gICAgd29yZFNwYW4ub25jbGljayA9ICgpID0+IHtcbiAgICAgIHRoYXRDbGlja2VkLmVtaXQod29yZCk7XG4gICAgfTtcblxuICAgIGxldCBub2RlID0gdGhpcy5yMi5jcmVhdGVUZXh0KHdvcmQudGV4dCk7XG5cbiAgICAvLyBzZXQgY29sb3JcbiAgICBpZiAod29yZC5jb2xvcikge1xuICAgICAgdGhpcy5yMi5zZXRTdHlsZSh3b3JkU3BhbiwgJ2NvbG9yJywgd29yZC5jb2xvcik7XG4gICAgfVxuXG4gICAgbGV0IHRyYW5zZm9ybVN0cmluZyA9ICcnO1xuXG4gICAgLy8gc2V0IGNvbG9yXG4gICAgaWYgKHdvcmQucm90YXRlKSB7XG4gICAgICB0cmFuc2Zvcm1TdHJpbmcgPSBgcm90YXRlKCR7d29yZC5yb3RhdGV9ZGVnKWA7XG4gICAgICB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAndHJhbnNmb3JtJywgdHJhbnNmb3JtU3RyaW5nKTtcbiAgICB9XG5cbiAgICAvLyBBcHBlbmQgaHJlZiBpZiB0aGVyZSdzIGEgbGluayBhbG9uZ3dpdGggdGhlIHRhZ1xuICAgIGlmICh3b3JkLmxpbmspIHtcbiAgICAgIGNvbnN0IHdvcmRMaW5rID0gdGhpcy5yMi5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICB3b3JkTGluay5ocmVmID0gd29yZC5saW5rO1xuXG4gICAgICBpZiAod29yZC5leHRlcm5hbCAhPT0gdW5kZWZpbmVkICYmIHdvcmQuZXh0ZXJuYWwpIHtcbiAgICAgICAgd29yZExpbmsudGFyZ2V0ID0gJ19ibGFuayc7XG4gICAgICB9XG5cbiAgICAgIHdvcmRMaW5rLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgbm9kZSA9IHdvcmRMaW5rO1xuICAgIH1cblxuICAgIC8vIHNldCB6b29tT3B0aW9uXG4gICAgaWYgKHRoaXMuem9vbU9uSG92ZXIgJiYgdGhpcy56b29tT25Ib3Zlci5zY2FsZSAhPT0gMSkge1xuICAgICAgaWYgKCF0aGlzLnpvb21PbkhvdmVyLnRyYW5zaXRpb25UaW1lKSB7IHRoaXMuem9vbU9uSG92ZXIudHJhbnNpdGlvblRpbWUgPSAwOyB9XG4gICAgICBpZiAoIXRoaXMuem9vbU9uSG92ZXIuc2NhbGUpIHsgdGhpcy56b29tT25Ib3Zlci5zY2FsZSA9IDE7IH1cblxuICAgICAgd29yZFNwYW4ub25tb3VzZW92ZXIgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMucjIuc2V0U3R5bGUod29yZFNwYW4sICd0cmFuc2l0aW9uJywgYHRyYW5zZm9ybSAke3RoaXMuem9vbU9uSG92ZXIudHJhbnNpdGlvblRpbWV9c2ApO1xuICAgICAgICB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAndHJhbnNmb3JtJywgYHNjYWxlKCR7dGhpcy56b29tT25Ib3Zlci5zY2FsZX0pICR7dHJhbnNmb3JtU3RyaW5nfWApO1xuICAgICAgICB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAndHJhbnNpdGlvbi1kZWxheScsIGAke3RoaXMuem9vbU9uSG92ZXIuZGVsYXl9c2ApO1xuICAgICAgICBpZiAodGhpcy56b29tT25Ib3Zlci5jb2xvcikge1xuICAgICAgICAgIHdvcmQubGlua1xuICAgICAgICAgICAgPyB0aGlzLnIyLnNldFN0eWxlKG5vZGUsICdjb2xvcicsIHRoaXMuem9vbU9uSG92ZXIuY29sb3IpXG4gICAgICAgICAgICA6IHRoaXMucjIuc2V0U3R5bGUod29yZFNwYW4sICdjb2xvcicsIHRoaXMuem9vbU9uSG92ZXIuY29sb3IpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB3b3JkU3Bhbi5vbm1vdXNlb3V0ID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAndHJhbnNmb3JtJywgYHNjYWxlKDEpICR7dHJhbnNmb3JtU3RyaW5nfWApO1xuICAgICAgICB3b3JkLmxpbmtcbiAgICAgICAgICA/IHRoaXMucjIucmVtb3ZlU3R5bGUobm9kZSwgJ2NvbG9yJylcbiAgICAgICAgICA6IHRoaXMucjIucmVtb3ZlU3R5bGUod29yZFNwYW4sICdjb2xvcicpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICB3b3JkU3Bhbi5hcHBlbmRDaGlsZChub2RlKTtcbiAgICB0aGlzLnIyLmFwcGVuZENoaWxkKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgd29yZFNwYW4pO1xuXG4gICAgY29uc3Qgd2lkdGggPSB3b3JkU3Bhbi5vZmZzZXRXaWR0aDtcbiAgICBjb25zdCBoZWlnaHQgPSB3b3JkU3Bhbi5vZmZzZXRIZWlnaHQ7XG4gICAgbGV0IGxlZnQgPSB0aGlzLl9vcHRpb25zLmNlbnRlci54O1xuICAgIGxldCB0b3AgPSB0aGlzLl9vcHRpb25zLmNlbnRlci55O1xuXG4gICAgLy8gU2F2ZSBhIHJlZmVyZW5jZSB0byB0aGUgc3R5bGUgcHJvcGVydHksIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcbiAgICBjb25zdCB3b3JkU3R5bGUgPSB3b3JkU3Bhbi5zdHlsZTtcbiAgICB3b3JkU3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuXG4gICAgLy8gcGxhY2UgdGhlIGZpcnN0IHdvcmRcbiAgICB3b3JkU3R5bGUubGVmdCA9IGxlZnQgKyAncHgnO1xuICAgIHdvcmRTdHlsZS50b3AgPSB0b3AgKyAncHgnO1xuXG4gICAgLy8gYWRkIHRvb2x0aXAgaWYgcHJvdmlkZWRcbiAgICBpZiAod29yZC50b29sdGlwKSB7XG4gICAgICB0aGlzLnIyLmFkZENsYXNzKHdvcmRTcGFuLCAndG9vbHRpcCcpO1xuICAgICAgY29uc3QgdG9vbHRpcFNwYW4gPSB0aGlzLnIyLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgIHRvb2x0aXBTcGFuLmNsYXNzTmFtZSA9ICd0b29sdGlwdGV4dCc7XG4gICAgICBjb25zdCB0ZXh0ID0gdGhpcy5yMi5jcmVhdGVUZXh0KHdvcmQudG9vbHRpcCk7XG4gICAgICB0b29sdGlwU3Bhbi5hcHBlbmRDaGlsZCh0ZXh0KTtcbiAgICAgIHdvcmRTcGFuLmFwcGVuZENoaWxkKHRvb2x0aXBTcGFuKTtcbiAgICB9XG5cbiAgICB3aGlsZSAodGhpcy5oaXRUZXN0KHdvcmRTcGFuLCB0aGlzLl9hbHJlYWR5UGxhY2VkV29yZHMpKSB7XG4gICAgICByYWRpdXMgKz0gdGhpcy5fb3B0aW9ucy5zdGVwO1xuICAgICAgYW5nbGUgKz0gKGluZGV4ICUgMiA9PT0gMCA/IDEgOiAtMSkgKiB0aGlzLl9vcHRpb25zLnN0ZXA7XG5cbiAgICAgIGxlZnQgPSB0aGlzLl9vcHRpb25zLmNlbnRlci54IC0gKHdpZHRoIC8gMi4wKSArIChyYWRpdXMgKiBNYXRoLmNvcyhhbmdsZSkpICogdGhpcy5fb3B0aW9ucy5hc3BlY3RSYXRpbztcbiAgICAgIHRvcCA9IHRoaXMuX29wdGlvbnMuY2VudGVyLnkgKyByYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkgLSAoaGVpZ2h0IC8gMi4wKTtcblxuICAgICAgd29yZFN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcbiAgICAgIHdvcmRTdHlsZS50b3AgPSB0b3AgKyAncHgnO1xuICAgIH1cblxuICAgIC8vIERvbid0IHJlbmRlciB3b3JkIGlmIHBhcnQgb2YgaXQgd291bGQgYmUgb3V0c2lkZSB0aGUgY29udGFpbmVyXG4gICAgaWYgKFxuICAgICAgIXRoaXMuX29wdGlvbnMub3ZlcmZsb3cgJiZcbiAgICAgIChsZWZ0IDwgMCB8fCB0b3AgPCAwIHx8IChsZWZ0ICsgd2lkdGgpID4gdGhpcy5fb3B0aW9ucy53aWR0aCB8fFxuICAgICAgKHRvcCArIGhlaWdodCkgPiB0aGlzLl9vcHRpb25zLmhlaWdodClcbiAgICApIHtcbiAgICAgIHdvcmRTcGFuLnJlbW92ZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2FscmVhZHlQbGFjZWRXb3Jkcy5wdXNoKHdvcmRTcGFuKTtcbiAgfVxuXG59XG4iXX0=