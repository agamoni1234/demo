/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ElementRef, Renderer2, HostListener } from '@angular/core';
/**
 * @record
 */
function CloudOptionsInternal() { }
if (false) {
    /** @type {?} */
    CloudOptionsInternal.prototype.step;
    /**
     * setting the aspect ratio. This value is calculated by the given width and height
     * @type {?}
     */
    CloudOptionsInternal.prototype.aspectRatio;
    /** @type {?} */
    CloudOptionsInternal.prototype.center;
}
var TagCloudComponent = /** @class */ (function () {
    function TagCloudComponent(el, r2) {
        this.el = el;
        this.r2 = r2;
        this.width = 500;
        this.height = 300;
        this.overflow = true;
        this.strict = false;
        this.zoomOnHover = { transitionTime: 0, scale: 1, delay: 0, color: null };
        this.realignOnResize = false;
        this.randomizeAngle = false;
        this.clicked = new EventEmitter();
        this.dataChanges = new EventEmitter();
        this.afterInit = new EventEmitter();
        this.afterChecked = new EventEmitter();
        this._alreadyPlacedWords = [];
    }
    /**
     * @param {?} event
     * @return {?}
     */
    TagCloudComponent.prototype.onResize = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        window.clearTimeout(this._timeoutId);
        this._timeoutId = window.setTimeout(function () {
            if (_this.realignOnResize) {
                _this.reDraw();
            }
        }, 200);
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TagCloudComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        this.reDraw(changes);
    };
    /**
     * @param {?=} changes
     * @return {?}
     */
    TagCloudComponent.prototype.reDraw = /**
     * @param {?=} changes
     * @return {?}
     */
    function (changes) {
        this.dataChanges.emit(changes);
        this._alreadyPlacedWords = [];
        // check if data is not null or empty
        if (!this.data) {
            console.error('angular-tag-cloud: No data passed. Please pass an Array of CloudData');
            return;
        }
        // values changed, reset cloud
        this.el.nativeElement.innerHTML = '';
        // set value changes
        if (changes && changes['data']) {
            this._dataArr = changes['data'].currentValue;
        }
        /** @type {?} */
        var width = this.width;
        if (this.el.nativeElement.parentNode.offsetWidth > 0
            && width <= 1
            && width > 0) {
            width = this.el.nativeElement.parentNode.offsetWidth * width;
        }
        // set options
        this._options = {
            step: 2.0,
            aspectRatio: (width / this.height),
            width: width,
            height: this.height,
            center: {
                x: (width / 2.0),
                y: (this.height / 2.0)
            },
            overflow: this.overflow,
            zoomOnHover: this.zoomOnHover
        };
        this.r2.setStyle(this.el.nativeElement, 'width', this._options.width + 'px');
        this.r2.setStyle(this.el.nativeElement, 'height', this._options.height + 'px');
        // draw the cloud
        this.drawWordCloud();
    };
    /**
     * @return {?}
     */
    TagCloudComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        this.afterInit.emit();
    };
    /**
     * @return {?}
     */
    TagCloudComponent.prototype.ngAfterContentChecked = /**
     * @return {?}
     */
    function () {
        this.afterChecked.emit();
    };
    // helper to generate a descriptive string for an entry to use when sorting alphabetically
    // helper to generate a descriptive string for an entry to use when sorting alphabetically
    /**
     * @param {?} entry
     * @return {?}
     */
    TagCloudComponent.prototype.descriptiveEntry = 
    // helper to generate a descriptive string for an entry to use when sorting alphabetically
    /**
     * @param {?} entry
     * @return {?}
     */
    function (entry) {
        /** @type {?} */
        var description = entry.text;
        if (entry.color) {
            description += '-' + entry.color;
        }
        if (entry.external) {
            description += '-' + entry.external;
        }
        if (entry.link) {
            description += '-' + entry.link;
        }
        if (entry.rotate) {
            description += '-' + entry.rotate;
        }
        return description;
    };
    /**
     * @return {?}
     */
    TagCloudComponent.prototype.drawWordCloud = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // Sort alphabetically to ensure that, all things being equal, words are placed uniformly
        this._dataArr.sort(function (a, b) { return (_this.descriptiveEntry(a)).localeCompare(_this.descriptiveEntry(b)); });
        // Sort this._dataArr from the word with the highest weight to the one with the lowest
        this._dataArr.sort(function (a, b) { return b.weight - a.weight; });
        this._dataArr.forEach(function (elem, index) {
            _this.drawWord(index, elem);
        });
    };
    // Helper function to test if an element overlaps others
    // Helper function to test if an element overlaps others
    /**
     * @param {?} currentEl
     * @param {?} otherEl
     * @return {?}
     */
    TagCloudComponent.prototype.hitTest = 
    // Helper function to test if an element overlaps others
    /**
     * @param {?} currentEl
     * @param {?} otherEl
     * @return {?}
     */
    function (currentEl, otherEl) {
        // Check elements for overlap one by one, stop and return false as soon as an overlap is found
        for (var i = 0; i < otherEl.length; i++) {
            if (this.overlapping(currentEl, otherEl[i])) {
                return true;
            }
        }
        return false;
    };
    // Pairwise overlap detection
    // Pairwise overlap detection
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    TagCloudComponent.prototype.overlapping = 
    // Pairwise overlap detection
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    function (a, b) {
        return (Math.abs(2.0 * a.offsetLeft + a.offsetWidth - 2.0 * b.offsetLeft - b.offsetWidth) < a.offsetWidth + b.offsetWidth &&
            Math.abs(2.0 * a.offsetTop + a.offsetHeight - 2.0 * b.offsetTop - b.offsetHeight) < a.offsetHeight + b.offsetHeight)
            ? true : false;
    };
    // Function to draw a word, by moving it in spiral until it finds a suitable empty place. This will be iterated on each word.
    // Function to draw a word, by moving it in spiral until it finds a suitable empty place. This will be iterated on each word.
    /**
     * @param {?} index
     * @param {?} word
     * @return {?}
     */
    TagCloudComponent.prototype.drawWord = 
    // Function to draw a word, by moving it in spiral until it finds a suitable empty place. This will be iterated on each word.
    /**
     * @param {?} index
     * @param {?} word
     * @return {?}
     */
    function (index, word) {
        var _this = this;
        // Define the ID attribute of the span that will wrap the word
        /** @type {?} */
        var angle = this.randomizeAngle ? 6.28 * Math.random() : 0;
        /** @type {?} */
        var radius = 0.0;
        /** @type {?} */
        var weight = 5;
        /** @type {?} */
        var wordSpan;
        // Check if min(weight) > max(weight) otherwise use default
        if (this._dataArr[0].weight > this._dataArr[this._dataArr.length - 1].weight) {
            // check if strict mode is active
            if (!this.strict) { // Linearly map the original weight to a discrete scale from 1 to 10
                weight = Math.round((word.weight - this._dataArr[this._dataArr.length - 1].weight) /
                    (this._dataArr[0].weight - this._dataArr[this._dataArr.length - 1].weight) * 9.0) + 1;
            }
            else { // use given value for weigth directly
                // fallback to 10
                if (word.weight > 10) {
                    weight = 10;
                    console.log("[TagCloud strict] Weight property " + word.weight + " > 10. Fallback to 10 as you are using strict mode", word);
                }
                else if (word.weight < 1) { // fallback to 1
                    weight = 1;
                    console.log("[TagCloud strict] Given weight property " + word.weight + " < 1. Fallback to 1 as you are using strict mode", word);
                }
                else if (word.weight % 1 !== 0) { // round if given value is not an integer
                    weight = Math.round(word.weight);
                    console.log("[TagCloud strict] Given weight property " + word.weight + " is not an integer. Rounded value to " + weight, word);
                }
                else {
                    weight = word.weight;
                }
            }
        }
        // Create a new span and insert node.
        wordSpan = this.r2.createElement('span');
        wordSpan.className = 'w' + weight;
        /** @type {?} */
        var thatClicked = this.clicked;
        wordSpan.onclick = function () {
            thatClicked.emit(word);
        };
        /** @type {?} */
        var node = this.r2.createText(word.text);
        // set color
        if (word.color) {
            this.r2.setStyle(wordSpan, 'color', word.color);
        }
        /** @type {?} */
        var transformString = '';
        // set color
        if (word.rotate) {
            transformString = "rotate(" + word.rotate + "deg)";
            this.r2.setStyle(wordSpan, 'transform', transformString);
        }
        // Append href if there's a link alongwith the tag
        if (word.link) {
            /** @type {?} */
            var wordLink = this.r2.createElement('a');
            wordLink.href = word.link;
            if (word.external !== undefined && word.external) {
                wordLink.target = '_blank';
            }
            wordLink.appendChild(node);
            node = wordLink;
        }
        // set zoomOption
        if (this.zoomOnHover && this.zoomOnHover.scale !== 1) {
            if (!this.zoomOnHover.transitionTime) {
                this.zoomOnHover.transitionTime = 0;
            }
            if (!this.zoomOnHover.scale) {
                this.zoomOnHover.scale = 1;
            }
            wordSpan.onmouseover = function () {
                _this.r2.setStyle(wordSpan, 'transition', "transform " + _this.zoomOnHover.transitionTime + "s");
                _this.r2.setStyle(wordSpan, 'transform', "scale(" + _this.zoomOnHover.scale + ") " + transformString);
                _this.r2.setStyle(wordSpan, 'transition-delay', _this.zoomOnHover.delay + "s");
                if (_this.zoomOnHover.color) {
                    word.link
                        ? _this.r2.setStyle(node, 'color', _this.zoomOnHover.color)
                        : _this.r2.setStyle(wordSpan, 'color', _this.zoomOnHover.color);
                }
            };
            wordSpan.onmouseout = function () {
                _this.r2.setStyle(wordSpan, 'transform', "scale(1) " + transformString);
                word.link
                    ? _this.r2.removeStyle(node, 'color')
                    : _this.r2.removeStyle(wordSpan, 'color');
            };
        }
        wordSpan.appendChild(node);
        this.r2.appendChild(this.el.nativeElement, wordSpan);
        /** @type {?} */
        var width = wordSpan.offsetWidth;
        /** @type {?} */
        var height = wordSpan.offsetHeight;
        /** @type {?} */
        var left = this._options.center.x;
        /** @type {?} */
        var top = this._options.center.y;
        // Save a reference to the style property, for better performance
        /** @type {?} */
        var wordStyle = wordSpan.style;
        wordStyle.position = 'absolute';
        // place the first word
        wordStyle.left = left + 'px';
        wordStyle.top = top + 'px';
        // add tooltip if provided
        if (word.tooltip) {
            this.r2.addClass(wordSpan, 'tooltip');
            /** @type {?} */
            var tooltipSpan = this.r2.createElement('span');
            tooltipSpan.className = 'tooltiptext';
            /** @type {?} */
            var text = this.r2.createText(word.tooltip);
            tooltipSpan.appendChild(text);
            wordSpan.appendChild(tooltipSpan);
        }
        while (this.hitTest(wordSpan, this._alreadyPlacedWords)) {
            radius += this._options.step;
            angle += (index % 2 === 0 ? 1 : -1) * this._options.step;
            left = this._options.center.x - (width / 2.0) + (radius * Math.cos(angle)) * this._options.aspectRatio;
            top = this._options.center.y + radius * Math.sin(angle) - (height / 2.0);
            wordStyle.left = left + 'px';
            wordStyle.top = top + 'px';
        }
        // Don't render word if part of it would be outside the container
        if (!this._options.overflow &&
            (left < 0 || top < 0 || (left + width) > this._options.width ||
                (top + height) > this._options.height)) {
            wordSpan.remove();
            return;
        }
        this._alreadyPlacedWords.push(wordSpan);
    };
    TagCloudComponent.decorators = [
        { type: Component, args: [{
                    selector: 'angular-tag-cloud, ng-tag-cloud, ngtc',
                    template: '',
                    styles: [":host{font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:normal;color:#09f;overflow:hidden;position:relative;display:block}span{padding:0}span.w10{font-size:550%}span.w9{font-size:500%}span.w8{font-size:450%}span.w7{font-size:400%}span.w6{font-size:350%}span.w5{font-size:300%}span.w4{font-size:250%}span.w3{font-size:200%}span.w2{font-size:150%}a:hover,span.w10,span.w8,span.w9{color:#0cf}span.w7{color:#39d}span.w6{color:#90c5f0}span.w5{color:#90a0dd}span.w4{color:#90c5f0}span.w3{color:#a0ddff}span.w2{color:#9ce}span.w1{font-size:100%;color:#aab5f0}.tooltip .tooltiptext{visibility:hidden;width:inherit;background-color:#555;color:#fff;text-align:center;border-radius:6px;padding:5px 10px;position:absolute;bottom:100%;left:0;opacity:0;transition:opacity .3s}.tooltip .tooltiptext::after{content:\"\";position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#555 transparent transparent}.tooltip:hover .tooltiptext{visibility:visible;opacity:1}"]
                }] }
    ];
    /** @nocollapse */
    TagCloudComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    TagCloudComponent.propDecorators = {
        data: [{ type: Input }],
        width: [{ type: Input }],
        height: [{ type: Input }],
        overflow: [{ type: Input }],
        strict: [{ type: Input }],
        zoomOnHover: [{ type: Input }],
        realignOnResize: [{ type: Input }],
        randomizeAngle: [{ type: Input }],
        clicked: [{ type: Output }],
        dataChanges: [{ type: Output }],
        afterInit: [{ type: Output }],
        afterChecked: [{ type: Output }],
        onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
    };
    return TagCloudComponent;
}());
export { TagCloudComponent };
if (false) {
    /** @type {?} */
    TagCloudComponent.prototype.data;
    /** @type {?} */
    TagCloudComponent.prototype.width;
    /** @type {?} */
    TagCloudComponent.prototype.height;
    /** @type {?} */
    TagCloudComponent.prototype.overflow;
    /** @type {?} */
    TagCloudComponent.prototype.strict;
    /** @type {?} */
    TagCloudComponent.prototype.zoomOnHover;
    /** @type {?} */
    TagCloudComponent.prototype.realignOnResize;
    /** @type {?} */
    TagCloudComponent.prototype.randomizeAngle;
    /** @type {?} */
    TagCloudComponent.prototype.clicked;
    /** @type {?} */
    TagCloudComponent.prototype.dataChanges;
    /** @type {?} */
    TagCloudComponent.prototype.afterInit;
    /** @type {?} */
    TagCloudComponent.prototype.afterChecked;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype._dataArr;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype._alreadyPlacedWords;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype._options;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype._timeoutId;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TagCloudComponent.prototype.r2;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFnLWNsb3VkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItdGFnLWNsb3VkLW1vZHVsZS8iLCJzb3VyY2VzIjpbInNyYy9hcHAvdGFnLWNsb3VkLW1vZHVsZS90YWctY2xvdWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUlULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFVBQVUsRUFDVixTQUFTLEVBRVQsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7O0FBRzdDLG1DQVdDOzs7SUFWQyxvQ0FBYTs7Ozs7SUFLYiwyQ0FBb0I7O0lBQ3BCLHNDQUdFOztBQUdKO0lBMEJFLDJCQUNVLEVBQWMsRUFDZCxFQUFhO1FBRGIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLE9BQUUsR0FBRixFQUFFLENBQVc7UUFyQmQsVUFBSyxHQUFJLEdBQUcsQ0FBQztRQUNiLFdBQU0sR0FBSSxHQUFHLENBQUM7UUFDZCxhQUFRLEdBQUksSUFBSSxDQUFDO1FBQ2pCLFdBQU0sR0FBSSxLQUFLLENBQUM7UUFDaEIsZ0JBQVcsR0FBd0IsRUFBRSxjQUFjLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDMUYsb0JBQWUsR0FBSSxLQUFLLENBQUM7UUFDekIsbUJBQWMsR0FBSSxLQUFLLENBQUM7UUFFdkIsWUFBTyxHQUE2QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3ZELGdCQUFXLEdBQWlDLElBQUksWUFBWSxFQUFFLENBQUM7UUFDL0QsY0FBUyxHQUF3QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3BELGlCQUFZLEdBQXdCLElBQUksWUFBWSxFQUFFLENBQUM7UUFHekQsd0JBQW1CLEdBQWtCLEVBQUUsQ0FBQztJQVE1QyxDQUFDOzs7OztJQUdMLG9DQUFROzs7O0lBRFIsVUFD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QSxBQS9SRCxJQStSQztTQTFSWSxpQkFBaUI7OztJQUM1QixpQ0FBMkI7O0lBQzNCLGtDQUFzQjs7SUFDdEIsbUNBQXVCOztJQUN2QixxQ0FBMEI7O0lBQzFCLG1DQUF5Qjs7SUFDekIsd0NBQW1HOztJQUNuRyw0Q0FBa0M7O0lBQ2xDLDJDQUFpQzs7SUFFakMsb0NBQWlFOztJQUNqRSx3Q0FBeUU7O0lBQ3pFLHNDQUE4RDs7SUFDOUQseUNBQWlFOzs7OztJQUVqRSxxQ0FBOEI7Ozs7O0lBQzlCLGdEQUFnRDs7Ozs7SUFFaEQscUNBQXVDOzs7OztJQUN2Qyx1Q0FBbUI7Ozs7O0lBR2pCLCtCQUFzQjs7Ozs7SUFDdEIsK0JBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LFxuICAgICAgICAgT25DaGFuZ2VzLFxuICAgICAgICAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICAgICAgIEFmdGVyQ29udGVudENoZWNrZWQsXG4gICAgICAgICBJbnB1dCxcbiAgICAgICAgIE91dHB1dCxcbiAgICAgICAgIEV2ZW50RW1pdHRlcixcbiAgICAgICAgIEVsZW1lbnRSZWYsXG4gICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgICBTaW1wbGVDaGFuZ2VzLFxuICAgICAgICAgSG9zdExpc3RlbmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDbG91ZERhdGEsIENsb3VkT3B0aW9ucywgWm9vbU9uSG92ZXJPcHRpb25zIH0gZnJvbSAnLi90YWctY2xvdWQuaW50ZXJmYWNlcyc7XG5cbmludGVyZmFjZSBDbG91ZE9wdGlvbnNJbnRlcm5hbCBleHRlbmRzIENsb3VkT3B0aW9ucyB7XG4gIHN0ZXA6IG51bWJlcjtcblxuICAvKipcbiAgICogc2V0dGluZyB0aGUgYXNwZWN0IHJhdGlvLiBUaGlzIHZhbHVlIGlzIGNhbGN1bGF0ZWQgYnkgdGhlIGdpdmVuIHdpZHRoIGFuZCBoZWlnaHRcbiAgICovXG4gIGFzcGVjdFJhdGlvOiBudW1iZXI7XG4gIGNlbnRlcjoge1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gIH07XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FuZ3VsYXItdGFnLWNsb3VkLCBuZy10YWctY2xvdWQsIG5ndGMnLFxuICB0ZW1wbGF0ZTogJycsXG4gIHN0eWxlVXJsczogWycuL3RhZy1jbG91ZC5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgVGFnQ2xvdWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIEFmdGVyQ29udGVudEluaXQsIEFmdGVyQ29udGVudENoZWNrZWQge1xuICBASW5wdXQoKSBkYXRhOiBDbG91ZERhdGFbXTtcbiAgQElucHV0KCkgd2lkdGg/ID0gNTAwO1xuICBASW5wdXQoKSBoZWlnaHQ/ID0gMzAwO1xuICBASW5wdXQoKSBvdmVyZmxvdz8gPSB0cnVlO1xuICBASW5wdXQoKSBzdHJpY3Q/ID0gZmFsc2U7XG4gIEBJbnB1dCgpIHpvb21PbkhvdmVyPzogWm9vbU9uSG92ZXJPcHRpb25zID0geyB0cmFuc2l0aW9uVGltZTogMCwgc2NhbGU6IDEsIGRlbGF5OiAwLCBjb2xvcjogbnVsbCB9O1xuICBASW5wdXQoKSByZWFsaWduT25SZXNpemU/ID0gZmFsc2U7XG4gIEBJbnB1dCgpIHJhbmRvbWl6ZUFuZ2xlPyA9IGZhbHNlO1xuXG4gIEBPdXRwdXQoKSBjbGlja2VkPzogRXZlbnRFbWl0dGVyPENsb3VkRGF0YT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBkYXRhQ2hhbmdlcz86IEV2ZW50RW1pdHRlcjxTaW1wbGVDaGFuZ2VzPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGFmdGVySW5pdD86IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGFmdGVyQ2hlY2tlZD86IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBwcml2YXRlIF9kYXRhQXJyOiBDbG91ZERhdGFbXTtcbiAgcHJpdmF0ZSBfYWxyZWFkeVBsYWNlZFdvcmRzOiBIVE1MRWxlbWVudFtdID0gW107XG5cbiAgcHJpdmF0ZSBfb3B0aW9uczogQ2xvdWRPcHRpb25zSW50ZXJuYWw7XG4gIHByaXZhdGUgX3RpbWVvdXRJZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgcjI6IFJlbmRlcmVyMlxuICApIHsgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnLCBbJyRldmVudCddKVxuICBvblJlc2l6ZShldmVudCkge1xuICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5fdGltZW91dElkKTtcbiAgICB0aGlzLl90aW1lb3V0SWQgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAodGhpcy5yZWFsaWduT25SZXNpemUpIHtcbiAgICAgICAgdGhpcy5yZURyYXcoKTtcbiAgICAgIH1cbiAgICB9LCAyMDApO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIHRoaXMucmVEcmF3KGNoYW5nZXMpO1xuICB9XG5cbiAgcmVEcmF3KGNoYW5nZXM/OiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgdGhpcy5kYXRhQ2hhbmdlcy5lbWl0KGNoYW5nZXMpO1xuICAgIHRoaXMuX2FscmVhZHlQbGFjZWRXb3JkcyA9IFtdO1xuXG4gICAgLy8gY2hlY2sgaWYgZGF0YSBpcyBub3QgbnVsbCBvciBlbXB0eVxuICAgIGlmICghdGhpcy5kYXRhKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdhbmd1bGFyLXRhZy1jbG91ZDogTm8gZGF0YSBwYXNzZWQuIFBsZWFzZSBwYXNzIGFuIEFycmF5IG9mIENsb3VkRGF0YScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHZhbHVlcyBjaGFuZ2VkLCByZXNldCBjbG91ZFxuICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5pbm5lckhUTUwgPSAnJztcblxuICAgIC8vIHNldCB2YWx1ZSBjaGFuZ2VzXG4gICAgaWYgKGNoYW5nZXMgJiYgY2hhbmdlc1snZGF0YSddKSB7XG4gICAgICB0aGlzLl9kYXRhQXJyID0gY2hhbmdlc1snZGF0YSddLmN1cnJlbnRWYWx1ZTtcbiAgICB9XG5cbiAgICBsZXQgd2lkdGggPSB0aGlzLndpZHRoO1xuICAgIGlmICh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50Tm9kZS5vZmZzZXRXaWR0aCA+IDBcbiAgICAgICYmIHdpZHRoIDw9IDFcbiAgICAgICYmIHdpZHRoID4gMFxuICAgICkge1xuICAgICAgd2lkdGggPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50Tm9kZS5vZmZzZXRXaWR0aCAqIHdpZHRoO1xuICAgIH1cblxuICAgIC8vIHNldCBvcHRpb25zXG4gICAgdGhpcy5fb3B0aW9ucyA9IHtcbiAgICAgIHN0ZXA6IDIuMCxcbiAgICAgIGFzcGVjdFJhdGlvOiAod2lkdGggLyB0aGlzLmhlaWdodCksXG4gICAgICB3aWR0aDogd2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LFxuICAgICAgY2VudGVyOiB7XG4gICAgICAgIHg6ICh3aWR0aCAvIDIuMCksXG4gICAgICAgIHk6ICh0aGlzLmhlaWdodCAvIDIuMClcbiAgICAgIH0sXG4gICAgICBvdmVyZmxvdzogdGhpcy5vdmVyZmxvdyxcbiAgICAgIHpvb21PbkhvdmVyOiB0aGlzLnpvb21PbkhvdmVyXG4gICAgfTtcblxuICAgIHRoaXMucjIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCB0aGlzLl9vcHRpb25zLndpZHRoICsgJ3B4Jyk7XG4gICAgdGhpcy5yMi5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdoZWlnaHQnLCB0aGlzLl9vcHRpb25zLmhlaWdodCArICdweCcpO1xuICAgIC8vIGRyYXcgdGhlIGNsb3VkXG4gICAgdGhpcy5kcmF3V29yZENsb3VkKCk7XG4gIH1cblxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICB0aGlzLmFmdGVySW5pdC5lbWl0KCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKSB7XG4gICAgdGhpcy5hZnRlckNoZWNrZWQuZW1pdCgpO1xuICB9XG5cbiAgLy8gaGVscGVyIHRvIGdlbmVyYXRlIGEgZGVzY3JpcHRpdmUgc3RyaW5nIGZvciBhbiBlbnRyeSB0byB1c2Ugd2hlbiBzb3J0aW5nIGFscGhhYmV0aWNhbGx5XG4gIGRlc2NyaXB0aXZlRW50cnkoZW50cnk6IENsb3VkRGF0YSk6IHN0cmluZyB7XG4gICAgbGV0IGRlc2NyaXB0aW9uID0gZW50cnkudGV4dDtcbiAgICBpZiAoZW50cnkuY29sb3IpIHtcbiAgICAgIGRlc2NyaXB0aW9uICs9ICctJyArIGVudHJ5LmNvbG9yO1xuICAgIH1cbiAgICBpZiAoZW50cnkuZXh0ZXJuYWwpIHtcbiAgICAgIGRlc2NyaXB0aW9uICs9ICctJyArIGVudHJ5LmV4dGVybmFsO1xuICAgIH1cbiAgICBpZiAoZW50cnkubGluaykge1xuICAgICAgZGVzY3JpcHRpb24gKz0gJy0nICsgZW50cnkubGluaztcbiAgICB9XG4gICAgaWYgKGVudHJ5LnJvdGF0ZSkge1xuICAgICAgZGVzY3JpcHRpb24gKz0gJy0nICsgZW50cnkucm90YXRlO1xuICAgIH1cbiAgICByZXR1cm4gZGVzY3JpcHRpb247XG4gIH1cblxuICBkcmF3V29yZENsb3VkICgpIHtcbiAgICAvLyBTb3J0IGFscGhhYmV0aWNhbGx5IHRvIGVuc3VyZSB0aGF0LCBhbGwgdGhpbmdzIGJlaW5nIGVxdWFsLCB3b3JkcyBhcmUgcGxhY2VkIHVuaWZvcm1seVxuICAgIHRoaXMuX2RhdGFBcnIuc29ydCggKGEsIGIpID0+ICh0aGlzLmRlc2NyaXB0aXZlRW50cnkoYSkpLmxvY2FsZUNvbXBhcmUodGhpcy5kZXNjcmlwdGl2ZUVudHJ5KGIpKSk7XG4gICAgLy8gU29ydCB0aGlzLl9kYXRhQXJyIGZyb20gdGhlIHdvcmQgd2l0aCB0aGUgaGlnaGVzdCB3ZWlnaHQgdG8gdGhlIG9uZSB3aXRoIHRoZSBsb3dlc3RcbiAgICB0aGlzLl9kYXRhQXJyLnNvcnQoKGEsIGIpID0+IGIud2VpZ2h0IC0gYS53ZWlnaHQpO1xuICAgIHRoaXMuX2RhdGFBcnIuZm9yRWFjaCgoZWxlbSwgaW5kZXgpID0+IHtcbiAgICAgIHRoaXMuZHJhd1dvcmQoaW5kZXgsIGVsZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHRlc3QgaWYgYW4gZWxlbWVudCBvdmVybGFwcyBvdGhlcnNcbiAgaGl0VGVzdChjdXJyZW50RWw6IEhUTUxFbGVtZW50LCBvdGhlckVsOiBIVE1MRWxlbWVudFtdKTogYm9vbGVhbiB7XG4gICAgLy8gQ2hlY2sgZWxlbWVudHMgZm9yIG92ZXJsYXAgb25lIGJ5IG9uZSwgc3RvcCBhbmQgcmV0dXJuIGZhbHNlIGFzIHNvb24gYXMgYW4gb3ZlcmxhcCBpcyBmb3VuZFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3RoZXJFbC5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRoaXMub3ZlcmxhcHBpbmcoY3VycmVudEVsLCBvdGhlckVsW2ldKSkgeyByZXR1cm4gdHJ1ZTsgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBQYWlyd2lzZSBvdmVybGFwIGRldGVjdGlvblxuICBvdmVybGFwcGluZyhhOiBIVE1MRWxlbWVudCwgYjogSFRNTEVsZW1lbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKE1hdGguYWJzKDIuMCAqIGEub2Zmc2V0TGVmdCArIGEub2Zmc2V0V2lkdGggIC0gMi4wICogYi5vZmZzZXRMZWZ0IC0gYi5vZmZzZXRXaWR0aCkgIDwgYS5vZmZzZXRXaWR0aCAgKyBiLm9mZnNldFdpZHRoICYmXG4gICAgICAgICAgICBNYXRoLmFicygyLjAgKiBhLm9mZnNldFRvcCAgKyBhLm9mZnNldEhlaWdodCAtIDIuMCAqIGIub2Zmc2V0VG9wICAtIGIub2Zmc2V0SGVpZ2h0KSA8IGEub2Zmc2V0SGVpZ2h0ICsgYi5vZmZzZXRIZWlnaHQpXG4gICAgPyB0cnVlIDogZmFsc2U7XG4gIH1cblxuICAvLyBGdW5jdGlvbiB0byBkcmF3IGEgd29yZCwgYnkgbW92aW5nIGl0IGluIHNwaXJhbCB1bnRpbCBpdCBmaW5kcyBhIHN1aXRhYmxlIGVtcHR5IHBsYWNlLiBUaGlzIHdpbGwgYmUgaXRlcmF0ZWQgb24gZWFjaCB3b3JkLlxuICBkcmF3V29yZChpbmRleDogbnVtYmVyLCB3b3JkOiBDbG91ZERhdGEpIHtcbiAgICAvLyBEZWZpbmUgdGhlIElEIGF0dHJpYnV0ZSBvZiB0aGUgc3BhbiB0aGF0IHdpbGwgd3JhcCB0aGUgd29yZFxuICAgIGxldCBhbmdsZSA9IHRoaXMucmFuZG9taXplQW5nbGUgPyA2LjI4ICogTWF0aC5yYW5kb20oKSA6IDAsXG4gICAgICAgIHJhZGl1cyA9IDAuMCxcbiAgICAgICAgd2VpZ2h0ID0gNSxcbiAgICAgICAgd29yZFNwYW46IEhUTUxFbGVtZW50O1xuXG4gICAgLy8gQ2hlY2sgaWYgbWluKHdlaWdodCkgPiBtYXgod2VpZ2h0KSBvdGhlcndpc2UgdXNlIGRlZmF1bHRcbiAgICBpZiAodGhpcy5fZGF0YUFyclswXS53ZWlnaHQgPiB0aGlzLl9kYXRhQXJyW3RoaXMuX2RhdGFBcnIubGVuZ3RoIC0gMV0ud2VpZ2h0KSB7XG4gICAgICAvLyBjaGVjayBpZiBzdHJpY3QgbW9kZSBpcyBhY3RpdmVcbiAgICAgIGlmICghdGhpcy5zdHJpY3QpIHsgLy8gTGluZWFybHkgbWFwIHRoZSBvcmlnaW5hbCB3ZWlnaHQgdG8gYSBkaXNjcmV0ZSBzY2FsZSBmcm9tIDEgdG8gMTBcbiAgICAgICAgd2VpZ2h0ID0gTWF0aC5yb3VuZCgod29yZC53ZWlnaHQgLSB0aGlzLl9kYXRhQXJyW3RoaXMuX2RhdGFBcnIubGVuZ3RoIC0gMV0ud2VpZ2h0KSAvXG4gICAgICAgICAgICAgICAgICAodGhpcy5fZGF0YUFyclswXS53ZWlnaHQgLSB0aGlzLl9kYXRhQXJyW3RoaXMuX2RhdGFBcnIubGVuZ3RoIC0gMV0ud2VpZ2h0KSAqIDkuMCkgKyAxO1xuICAgICAgfSBlbHNlIHsgLy8gdXNlIGdpdmVuIHZhbHVlIGZvciB3ZWlndGggZGlyZWN0bHlcbiAgICAgICAgLy8gZmFsbGJhY2sgdG8gMTBcbiAgICAgICAgaWYgKHdvcmQud2VpZ2h0ID4gMTApIHtcbiAgICAgICAgICB3ZWlnaHQgPSAxMDtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW1RhZ0Nsb3VkIHN0cmljdF0gV2VpZ2h0IHByb3BlcnR5ICR7d29yZC53ZWlnaHR9ID4gMTAuIEZhbGxiYWNrIHRvIDEwIGFzIHlvdSBhcmUgdXNpbmcgc3RyaWN0IG1vZGVgLCB3b3JkKTtcbiAgICAgICAgfSBlbHNlIGlmICh3b3JkLndlaWdodCA8IDEpIHsgLy8gZmFsbGJhY2sgdG8gMVxuICAgICAgICAgIHdlaWdodCA9IDE7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtUYWdDbG91ZCBzdHJpY3RdIEdpdmVuIHdlaWdodCBwcm9wZXJ0eSAke3dvcmQud2VpZ2h0fSA8IDEuIEZhbGxiYWNrIHRvIDEgYXMgeW91IGFyZSB1c2luZyBzdHJpY3QgbW9kZWAsIHdvcmQpO1xuICAgICAgICB9IGVsc2UgaWYgKHdvcmQud2VpZ2h0ICUgMSAhPT0gMCkgeyAvLyByb3VuZCBpZiBnaXZlbiB2YWx1ZSBpcyBub3QgYW4gaW50ZWdlclxuICAgICAgICAgIHdlaWdodCA9IE1hdGgucm91bmQod29yZC53ZWlnaHQpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbVGFnQ2xvdWQgc3RyaWN0XSBHaXZlbiB3ZWlnaHQgcHJvcGVydHkgJHt3b3JkLndlaWdodH0gaXMgbm90IGFuIGludGVnZXIuIFJvdW5kZWQgdmFsdWUgdG8gJHt3ZWlnaHR9YCwgd29yZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgd2VpZ2h0ID0gd29yZC53ZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBhIG5ldyBzcGFuIGFuZCBpbnNlcnQgbm9kZS5cbiAgICB3b3JkU3BhbiA9IHRoaXMucjIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIHdvcmRTcGFuLmNsYXNzTmFtZSA9ICd3JyArIHdlaWdodDtcblxuICAgIGNvbnN0IHRoYXRDbGlja2VkID0gdGhpcy5jbGlja2VkO1xuICAgIHdvcmRTcGFuLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGF0Q2xpY2tlZC5lbWl0KHdvcmQpO1xuICAgIH07XG5cbiAgICBsZXQgbm9kZSA9IHRoaXMucjIuY3JlYXRlVGV4dCh3b3JkLnRleHQpO1xuXG4gICAgLy8gc2V0IGNvbG9yXG4gICAgaWYgKHdvcmQuY29sb3IpIHtcbiAgICAgIHRoaXMucjIuc2V0U3R5bGUod29yZFNwYW4sICdjb2xvcicsIHdvcmQuY29sb3IpO1xuICAgIH1cblxuICAgIGxldCB0cmFuc2Zvcm1TdHJpbmcgPSAnJztcblxuICAgIC8vIHNldCBjb2xvclxuICAgIGlmICh3b3JkLnJvdGF0ZSkge1xuICAgICAgdHJhbnNmb3JtU3RyaW5nID0gYHJvdGF0ZSgke3dvcmQucm90YXRlfWRlZylgO1xuICAgICAgdGhpcy5yMi5zZXRTdHlsZSh3b3JkU3BhbiwgJ3RyYW5zZm9ybScsIHRyYW5zZm9ybVN0cmluZyk7XG4gICAgfVxuXG4gICAgLy8gQXBwZW5kIGhyZWYgaWYgdGhlcmUncyBhIGxpbmsgYWxvbmd3aXRoIHRoZSB0YWdcbiAgICBpZiAod29yZC5saW5rKSB7XG4gICAgICBjb25zdCB3b3JkTGluayA9IHRoaXMucjIuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgd29yZExpbmsuaHJlZiA9IHdvcmQubGluaztcblxuICAgICAgaWYgKHdvcmQuZXh0ZXJuYWwgIT09IHVuZGVmaW5lZCAmJiB3b3JkLmV4dGVybmFsKSB7XG4gICAgICAgIHdvcmRMaW5rLnRhcmdldCA9ICdfYmxhbmsnO1xuICAgICAgfVxuXG4gICAgICB3b3JkTGluay5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgIG5vZGUgPSB3b3JkTGluaztcbiAgICB9XG5cbiAgICAvLyBzZXQgem9vbU9wdGlvblxuICAgIGlmICh0aGlzLnpvb21PbkhvdmVyICYmIHRoaXMuem9vbU9uSG92ZXIuc2NhbGUgIT09IDEpIHtcbiAgICAgIGlmICghdGhpcy56b29tT25Ib3Zlci50cmFuc2l0aW9uVGltZSkgeyB0aGlzLnpvb21PbkhvdmVyLnRyYW5zaXRpb25UaW1lID0gMDsgfVxuICAgICAgaWYgKCF0aGlzLnpvb21PbkhvdmVyLnNjYWxlKSB7IHRoaXMuem9vbU9uSG92ZXIuc2NhbGUgPSAxOyB9XG5cbiAgICAgIHdvcmRTcGFuLm9ubW91c2VvdmVyID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAndHJhbnNpdGlvbicsIGB0cmFuc2Zvcm0gJHt0aGlzLnpvb21PbkhvdmVyLnRyYW5zaXRpb25UaW1lfXNgKTtcbiAgICAgICAgdGhpcy5yMi5zZXRTdHlsZSh3b3JkU3BhbiwgJ3RyYW5zZm9ybScsIGBzY2FsZSgke3RoaXMuem9vbU9uSG92ZXIuc2NhbGV9KSAke3RyYW5zZm9ybVN0cmluZ31gKTtcbiAgICAgICAgdGhpcy5yMi5zZXRTdHlsZSh3b3JkU3BhbiwgJ3RyYW5zaXRpb24tZGVsYXknLCBgJHt0aGlzLnpvb21PbkhvdmVyLmRlbGF5fXNgKTtcbiAgICAgICAgaWYgKHRoaXMuem9vbU9uSG92ZXIuY29sb3IpIHtcbiAgICAgICAgICB3b3JkLmxpbmtcbiAgICAgICAgICAgID8gdGhpcy5yMi5zZXRTdHlsZShub2RlLCAnY29sb3InLCB0aGlzLnpvb21PbkhvdmVyLmNvbG9yKVxuICAgICAgICAgICAgOiB0aGlzLnIyLnNldFN0eWxlKHdvcmRTcGFuLCAnY29sb3InLCB0aGlzLnpvb21PbkhvdmVyLmNvbG9yKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgd29yZFNwYW4ub25tb3VzZW91dCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5yMi5zZXRTdHlsZSh3b3JkU3BhbiwgJ3RyYW5zZm9ybScsIGBzY2FsZSgxKSAke3RyYW5zZm9ybVN0cmluZ31gKTtcbiAgICAgICAgd29yZC5saW5rXG4gICAgICAgICAgPyB0aGlzLnIyLnJlbW92ZVN0eWxlKG5vZGUsICdjb2xvcicpXG4gICAgICAgICAgOiB0aGlzLnIyLnJlbW92ZVN0eWxlKHdvcmRTcGFuLCAnY29sb3InKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgd29yZFNwYW4uYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgdGhpcy5yMi5hcHBlbmRDaGlsZCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIHdvcmRTcGFuKTtcblxuICAgIGNvbnN0IHdpZHRoID0gd29yZFNwYW4ub2Zmc2V0V2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gd29yZFNwYW4ub2Zmc2V0SGVpZ2h0O1xuICAgIGxldCBsZWZ0ID0gdGhpcy5fb3B0aW9ucy5jZW50ZXIueDtcbiAgICBsZXQgdG9wID0gdGhpcy5fb3B0aW9ucy5jZW50ZXIueTtcblxuICAgIC8vIFNhdmUgYSByZWZlcmVuY2UgdG8gdGhlIHN0eWxlIHByb3BlcnR5LCBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gICAgY29uc3Qgd29yZFN0eWxlID0gd29yZFNwYW4uc3R5bGU7XG4gICAgd29yZFN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcblxuICAgIC8vIHBsYWNlIHRoZSBmaXJzdCB3b3JkXG4gICAgd29yZFN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcbiAgICB3b3JkU3R5bGUudG9wID0gdG9wICsgJ3B4JztcblxuICAgIC8vIGFkZCB0b29sdGlwIGlmIHByb3ZpZGVkXG4gICAgaWYgKHdvcmQudG9vbHRpcCkge1xuICAgICAgdGhpcy5yMi5hZGRDbGFzcyh3b3JkU3BhbiwgJ3Rvb2x0aXAnKTtcbiAgICAgIGNvbnN0IHRvb2x0aXBTcGFuID0gdGhpcy5yMi5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICB0b29sdGlwU3Bhbi5jbGFzc05hbWUgPSAndG9vbHRpcHRleHQnO1xuICAgICAgY29uc3QgdGV4dCA9IHRoaXMucjIuY3JlYXRlVGV4dCh3b3JkLnRvb2x0aXApO1xuICAgICAgdG9vbHRpcFNwYW4uYXBwZW5kQ2hpbGQodGV4dCk7XG4gICAgICB3b3JkU3Bhbi5hcHBlbmRDaGlsZCh0b29sdGlwU3Bhbik7XG4gICAgfVxuXG4gICAgd2hpbGUgKHRoaXMuaGl0VGVzdCh3b3JkU3BhbiwgdGhpcy5fYWxyZWFkeVBsYWNlZFdvcmRzKSkge1xuICAgICAgcmFkaXVzICs9IHRoaXMuX29wdGlvbnMuc3RlcDtcbiAgICAgIGFuZ2xlICs9IChpbmRleCAlIDIgPT09IDAgPyAxIDogLTEpICogdGhpcy5fb3B0aW9ucy5zdGVwO1xuXG4gICAgICBsZWZ0ID0gdGhpcy5fb3B0aW9ucy5jZW50ZXIueCAtICh3aWR0aCAvIDIuMCkgKyAocmFkaXVzICogTWF0aC5jb3MoYW5nbGUpKSAqIHRoaXMuX29wdGlvbnMuYXNwZWN0UmF0aW87XG4gICAgICB0b3AgPSB0aGlzLl9vcHRpb25zLmNlbnRlci55ICsgcmFkaXVzICogTWF0aC5zaW4oYW5nbGUpIC0gKGhlaWdodCAvIDIuMCk7XG5cbiAgICAgIHdvcmRTdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7XG4gICAgICB3b3JkU3R5bGUudG9wID0gdG9wICsgJ3B4JztcbiAgICB9XG5cbiAgICAvLyBEb24ndCByZW5kZXIgd29yZCBpZiBwYXJ0IG9mIGl0IHdvdWxkIGJlIG91dHNpZGUgdGhlIGNvbnRhaW5lclxuICAgIGlmIChcbiAgICAgICF0aGlzLl9vcHRpb25zLm92ZXJmbG93ICYmXG4gICAgICAobGVmdCA8IDAgfHwgdG9wIDwgMCB8fCAobGVmdCArIHdpZHRoKSA+IHRoaXMuX29wdGlvbnMud2lkdGggfHxcbiAgICAgICh0b3AgKyBoZWlnaHQpID4gdGhpcy5fb3B0aW9ucy5oZWlnaHQpXG4gICAgKSB7XG4gICAgICB3b3JkU3Bhbi5yZW1vdmUoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9hbHJlYWR5UGxhY2VkV29yZHMucHVzaCh3b3JkU3Bhbik7XG4gIH1cblxufVxuIl19